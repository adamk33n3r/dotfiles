<html>
<head>

<link href="style.css" rel="stylesheet" type="text/css">

</head>
<body>
<div id="content">
  <img src='images/untiny_logo.gif' onMouseMove="document.Form1.txtShortUrl.focus();"/>
 <!-- <img src="images/Untitled1.png" class="egg1">-->

<div id="Extract_box">
<form name="Form1">
<input type='text' onkeypress='return submitenter(event)' id='txtShortUrl' value='' class="swap_value" />
<input type="button" id="btnExtract" onClick="btnExtract_click()"  />
</form>
</div>

<img src="images/down.png" id="down_arrow" >
<!--<input type='button' id='btnExtract' onclick='btnExtract_click()' value='Extract' />-->
<div id="go_box" >
<form name="Form2">
<input type='text' id='realurl' title="Click to Select All and copy to clipboard" onClick="CopyToClipboard();"/ >
<input type='button' id='go' onclick='gourl();' />
</form>
</div>


<div align="center">
  <img src='images/loader.gif' name="imgLoading" id='imgLoading' style='display: none;' />  </div>
  <div align="center" id='divResult' style="color:red"></div>


<script>

var longUrl = undefined;
var shortUrl = undefined;


function btnExtract_click()
{
		document.getElementById('imgLoading').style.display='inline';
		var textBox = document.getElementById('txtShortUrl');
		shortUrl = textBox.value;
		
		var req = new XMLHttpRequest();
		
		req.open(
			"GET",
			"http://untiny.me/api/1.0/extract?url="+shortUrl+"&format=text",
		true);
		req.send(null);
		req.onload = function() {
			if(req.responseText) {
				
				longUrl =  req.responseText;
			}
			else 
			{
				shortUrl =  longUrl;
			}
				//document.getElementById('divResult').innerHTML = "<a href='"+ longUrl +"'>"+longUrl+"</a>";
				document.getElementById('imgLoading').style.display='none';
				//chrome.tabs.create({'url':longUrl});
				if (textBox.value==null||textBox.value=="")
				 {
				document.getElementById('divResult').innerHTML="Error !";
				 }
				 else
				 {
				document.getElementById('go_box').style.display = 'block';
				document.getElementById('down_arrow').style.display = 'block';
				document.Form2.realurl.value = longUrl;
				}
				 
				 
			}
}

function gourl(){
chrome.tabs.create({'url':longUrl});
} 


function submitenter(e)
{
    var keycode;
    if (window.event) keycode = window.event.keyCode;
    else if (e) keycode = e.which;
    else return true;

    if (keycode == 13)
   {
        btnExtract_click();
        return false;
   }
   else
       return true;
}


function CopyToClipboard()
{
   document.Form2.realurl.focus();
   document.Form2.realurl.select(); 
   document.execCommand("copy");
}

function startUp() {
   var currentVersion = '1.3';
   var version = localStorage["version"];
   if ( typeof version == "undefined" || version != currentVersion) {
      chrome.tabs.create({ url: chrome.extension.getURL('welcome.html'), selected: true });
      localStorage["version"] = currentVersion;
   }
}
startUp();		 
</script>
</div>

</body>
</html>