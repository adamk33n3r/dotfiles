if("undefined"==typeof runningaudiovideo){var runningaudiovideo=!0,exportsaudiovideo={};!function(){var e={},t={},n=2;chrome.storage.local.get(null,function(t){e=t,0==--n&&E()}),chrome.storage.sync.get(null,function(e){if(t=e,!t.test)for(var o in console)console[o]=function(){};0==--n&&E()});var o=function(n,o){if("local"==o)for(var i in n)e[i]=n[i].newValue;else if("sync"==o)for(var i in n)t[i]=n[i].newValue};chrome.storage.onChanged.addListener(o);var i=function(e,t){return t+1+": "+(e.constructor===HTMLVideoElement?"Video":"Audio")},a=function(e){if(e.constructor!==HTMLVideoElement)return null;var t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight;var n=t.getContext("2d");n.drawImage(e,0,0,t.width,t.height);try{return t.toDataURL("image/png")}catch(o){return null}},s=function(e){return e==c?!0:(e.paused||c.paused&&u({elem:e}),!1)},l=function(){for(var e=document.querySelectorAll("audio, video"),t=0;t<e.length;t++)e[t].duration<4&&(e.splice(t,1),t--);return e},u=function(e){r=l();var t=null;if("playlist"in e&&(t=parseInt(e.playlist.replace(/:.+$/,""))-1),"elem"in e)for(var n=0;n<r.length;n++)if(r[n]==e.elem){t=n;break}"index"in e&&(t=e.index),null!==t&&r[t]&&r[t]!=c&&(console.log("set",t),f.pause(),c=r[t],p=t,f.play(),d.postMessage({isplaying:g.isplaying(),song:g.song(),artist:g.artist(),album:g.album(),albumart:g.albumart(),songvote:g.songvote(),volume:g.volume(),playlists:g.playlists(),playlist:g.playlist()}))};window.MutationObserver=window.MutationObserver||window.WebkitMutationObserver;var r=[],c=null,p=null,v={},d=null,m={},g={},f={},y=!1,h=function(e,t,n){return n&&t===m[e]?void 0:m[e]=t};g.isplaying=function(e){return h("isplaying",c&&!c.paused,e)},g.song=function(e){return h("song",document.title,e)},g.artist=function(e){return h("artist",location.hostname,e)},g.album=function(e){return h("album","",e)},g.albumart=function(e){var t="";return c&&(t=c.getAttribute("poster")||a(c)||""),h("albumart",t,e)},g.songvote=function(e){return h("songvote",0,e)},g.volume=function(e){var t=1;return c&&(t=c.muted?0:c.volume),h("volume",t,e)},g.playlists=function(e){var t=[];r=l();for(var n=0;n<r.length;n++)t.push(i(r[n],n));return console.log("pls",t),h("playlists",t,e)},g.playlist=function(e){var t=void 0;r=l();for(var n=0;n<r.length;n++)r[n]==c&&(t=i(r[n],n));return console.log("pl",t),h("playlist",t,e)},g.elapsedtime=function(e){return h("elapsedtime",c&&Math.round(c.currentTime),e)},g.totaltime=function(e){return h("totaltime",c&&Math.round(c.duration),e)},f.play=function(){y=!1,c.paused&&c.play()},f.pause=function(){c.paused||c.pause()},f.forcepaused=function(){y=!0,f.pause()},f.prev=function(){y=!1,p>0&&f.playlist(i(r[p-1],p-1))},f.next=function(){y=!1,p+1<r.length&&f.playlist(i(r[p+1],p+1))},f.songvote=function(){},f.volume=function(e){c.volume=e,c.muted=0==e},f.seek=function(e){c.currentTime=c.duration*e},f.playlist=function(e){u({playlist:e})};var b=function(){console.log("]] connect-av"),r=l(),c=r[0],p=0,d=chrome.runtime.connect({name:JSON.stringify({name:"playerport",type:"audiovideo",isplaying:g.isplaying(),song:g.song(),artist:g.artist(),album:g.album(),albumart:g.albumart(),songvote:g.songvote(),volume:g.volume(),playlists:g.playlists(),playlist:g.playlist()})}),d.onMessage.addListener(L),d.onDisconnect.addListener(w),d._postMessage=d.postMessage,d.postMessage=function(){try{d._postMessage.apply(d,arguments)}catch(e){w()}};for(var e=0;e<r.length;e++)r[e].addEventListener("timeupdate",M.timeupdate,!0),r[e].addEventListener("playing",M.playing,!0),r[e].addEventListener("pause",M.pause,!0),r[e].addEventListener("volumechange",M.volumechange,!0);v={}},M={};M.timeupdate=function(){s(this)&&void 0!==g.elapsedtime(!0)&&d.postMessage({elapsedTime:m.elapsedtime,totalTime:g.totaltime()})},M.playing=function(){u({elem:this}),s(this)&&void 0!==g.isplaying(!0)&&(y&&m.isplaying?f.forcepaused():d.postMessage({isplaying:m.isplaying}))},M.pause=function(){s(this)&&void 0!==g.isplaying(!0)&&d.postMessage({isplaying:m.isplaying})},M.volumechange=function(){s(this)&&void 0!==g.volume(!0)&&d.postMessage({volume:m.volume})};var w=function(){if(console.log("]] ondisconnect"),d)try{d.disconnect()}catch(e){}d=null,runningaudiovideo=void 0;for(var t in v)v[t].disconnect();for(var n=0;n<r.length;n++)r[n].removeEventListener("timeupdate",M.timeupdate,!0),r[n].removeEventListener("playing",M.playing,!0),r[n].removeEventListener("pause",M.pause,!0),r[n].removeEventListener("volumechange",M.volumechange,!0);try{chrome.storage.onChanged.removeListener(o)}catch(e){}},L=function(e){"play"==e.action&&f.play(),"pause"==e.action&&f.pause(),"forcepaused"==e.action&&f.forcepaused(),"prev"==e.action&&f.prev(),"next"==e.action&&f.next(),"thumbup"==e.action&&f.songvote(1),"thumbdown"==e.action&&f.songvote(-1),"setvolume"==e.action&&f.volume(e.volume),"seek"==e.action&&f.seek(e.seek),"setplaylist"==e.action&&f.playlist(e.playlist)},E=function(){if(location.href.match(/^(https?:\/\/([^\/]+\.)*youtube(-nocookie)?\.com\/|https?:\/\/app\.stitcher\.com\/|https?:\/\/www\.slacker\.com\/)/))return void(runningaudiovideo=void 0);var e=function(){var t=l();return 0==t.length?setTimeout(e,1e3):void b()};setTimeout(e,10)}}()}