if("undefined"==typeof running){var running=!0,exports={};!function(){var e={},t={},o=2;chrome.storage.local.get(null,function(t){console.log("local"),e=t,0==--o&&d()}),chrome.storage.sync.get(null,function(e){if(console.log("sync"),t=e,!t.test)for(var n in console)console[n]=function(){};0==--o&&d()});var n=function(o,n){if("local"==n)for(var i in o)e[i]=o[i].newValue;else if("sync"==n)for(var i in o)t[i]=o[i].newValue;u()};chrome.storage.onChanged.addListener(n);var i=["pandora","youtube","googlemusic","playspotify","soundcloud","amazoncloud","grooveshark","digitallyimported","cmdfm","audiovideo","songza","rdio","stitcher","iheart","8tracks","beatsmusic","slacker","tunein","radio","earbits"],s={pandora:{title:"Pandora",url:"http://pandora.com/",origins:["*://*.pandora.com/*","*://*.p-cdn.com/*"]},youtube:{title:"Youtube",url:"http://www.youtube.com/",origins:["*://*.youtube.com/*","*://*.ytimg.com/*"],all_urls:!0},googlemusic:{title:"Google Music",url:"http://play.google.com/music/",origins:["*://play.google.com/music/*","*://*.googleusercontent.com/*"]},grooveshark:{title:"Grooveshark",url:"http://grooveshark.com/",origins:["*://*.grooveshark.com/*","*://*.gs-cdn.net/*"]},digitallyimported:{title:"Digitally Imported",url:"http://www.di.fm/",origins:["*://*.di.fm/*","*://static.audioaddict.com/*"]},soundcloud:{title:"SoundCloud",url:"https://soundcloud.com/",origins:["*://*.soundcloud.com/*","*://*.sndcdn.com/*"]},playspotify:{title:"Spotify Web",url:"https://play.spotify.com",origins:["*://*.spotify.com/*","*://*.cloudfront.net/*"]},cmdfm:{title:"cmd.fm",url:"https://cmd.fm",origins:["*://*.cmd.fm/*"]},amazoncloud:{title:"Amazon Music",url:"https://www.amazon.com/gp/dmusic/cloudplayer/player",origins:["*://*.amazon.com/*","*://*.album-art-storage-us.s3.amazonaws.com/*"]},audiovideo:{title:"Web Audio",url:"http://www.html5rocks.com/en/tutorials/video/basics/",origins:["<all_urls>"]},songza:{title:"Songza",url:"http://songza.com/",origins:["*://*.songza.com/*"]},rdio:{title:"Rdio",url:"https://www.rdio.com/",origins:["*://*.rdio.com/*","*://*.cdn1-rdio.com/*","*://*.cdn2-rdio.com/*","*://*.akamaihd.net/*"]},stitcher:{title:"Stitcher",url:"http://app.stitcher.com/",origins:["*://*.stitcher.com/*"]},iheart:{title:"iHeart Radio",url:"http://www.iheart.com/",origins:["*://*.iheart.com/*"]},"8tracks":{title:"8tracks",url:"http://8tracks.com/",origins:["*://*.8tracks.com/*"]},beatsmusic:{title:"Beats Music",url:"https://listen.beatsmusic.com/",origins:["*://*.beatsmusic.com/*"]},slacker:{title:"Slacker",url:"http://www.slacker.com/",origins:["*://*.slacker.com/*","*://*.slkimg.com/*"]},tunein:{title:"TuneIn",url:"http://tunein.com/",origins:["*://*.tunein.com/*"]},radio:{title:"Radio.com",url:"http://player.radio.com/",origins:["*://*.radio.com/*"]},earbits:{title:"Earbits",url:"http://www.earbits.com/",origins:["*://*.earbits.com/*"]}},c=0,l=function(){chrome.tabs.create({url:"http://soundcontrolplus.com/id/?clid="+e.id+"&fi="+t.firstinstalled+"&n=/pay/"}),$(window).focus(function(){e.license||(e.needping=!0,chrome.storage.local.set({needping:e.needping}),setTimeout(function(){e.license||(e.needping=!0,chrome.storage.local.set({needping:e.needping}))},3e3))})},a=function(e){$(".message",p).html(e),p.appendTo("body")},r=function(){p[0].parentNode.removeChild(p[0])},p=$("<div id=plusalert>").click(r).append($("<div class=container>").click(function(){return!1}).append($("<div class=close>").html("&times;").click(r)).append($("<div class=message>")).append($("<div class=upgradeplus>").append($("<span class=upgradebutton>Get <span class=sctitle>SoundControl<span class=scplus> plus<span class=arrow> &#x276F;</span></span></span></span>").click(l).mouseenter(function(){$(".scplus",this).stop().animate({left:".4em"},100)}).mouseleave(function(){$(".scplus",this).stop().animate({left:"0"},200)})))),u=function(){if(console.log("refresh"),e.id&&t.clickset&&$("#header").length){console.log("do"),window.refreshed||(window.refreshed=!0,resetPlayers(),e.needping=!0,chrome.storage.local.set({needping:e.needping})),$("body").removeClass("plusactive liteactive"),e.license.match(/plus$/)?($("body").addClass("plusactive"),$(".sclicense").html("<span class=scplus> plus</span>")):e.license.match(/lite$/)?($("body").addClass("liteactive"),$(".sclicense").html("<span class=sclite> lite</span>")):$(".sclicense").html(""),(t.closereview||(new Date).getTime()-e.installed<36e5)&&$(".pleasereview").css({display:"none"});for(var o=1;c>=o;o++)$("#click"+o).css({display:o<=t.clickset.length+1?"block":"none"}),$("#click"+o+" option").prop("disabled",!1),$("#click"+o+" select").css({display:""});for(var o=0;o<t.clickset.length;o++)$("option[value="+t.clickset[o]+"]").prop("disabled",!0),$("#click"+(o+1)+" option[value="+t.clickset[o]+"]").prop("disabled",!1),$("#click"+(o+1)+" select").val(t.clickset[o]);$("#click"+(t.clickset.length+1)+" select").val(""),$("#tabstate select").val(t.hidetab?"hidden":t.pintab.pandora?"pinned":"normal"),$("#advolume select").val(t.advolume),$("#initplaystate select").val(t.initplaystate.pandora),$("#skipvideoad input").prop("checked",t.skipvideoad.pandora),$("#listening input").prop("checked",t.listening),$("#songnotify select").val(t.songnotify),$("#notifyprogress input").prop("checked",!t.hidenotifyprogress).prop("disabled",t.songnotify>8),$("#timer_end select").val(t.timer_end),$("#timer_minutes select").val(t.timer_minutes),$("#artbutton input").prop("checked",t.artbutton),$("#pauselocked input").prop("checked",t.pauselocked),chrome.commands&&chrome.commands.getAll?chrome.commands.getAll(function(e){$("#keyboardset #command_execute_browser_action .descrip").text("Click Icon");for(var t=0;t<e.length;t++)$("#keyboardset #command"+e[t].name+" .control").text(e[t].shortcut||"--")}):$("#keyboardset").css({display:"none"}),console.log("visible"),$("body").css({visibility:"visible"})}},d=function(){$(function(){console.log("init"),$(".issuelinks div").on("click",function(){window.open("https://github.com/SoundControl/Issues/issues")}),$(".pleasereview .close").on("click",function(){$(".pleasereview").css({display:"none"}),t.closereview=!0,chrome.storage.sync.set({closereview:t.closereview})}),$(".pleasereview .link").on("click",function(){window.open("https://chrome.google.com/webstore/detail/dckjilenognecmpjjpeckgekikdpchli/reviews"),$(".pleasereview").css({display:"none"}),t.closereview=!0,chrome.storage.sync.set({closereview:t.closereview})}),$(".upgradebutton").on("click",l).on("mouseenter",function(){$(".scplus",this).stop().animate({left:".4em"},100)}).on("mouseleave",function(){$(".scplus",this).stop().animate({left:"0"},200)}),$(".linkchangelog").on("click",function(){window.open(chrome.extension.getURL("changelog.html"))}),$(".linklicense").on("click",function(){window.open(chrome.extension.getURL("plus.html"))}),$("#hiddenbutton .link").on("click",function(){$("#hiddensettings").show(),document.body.scrollTop=document.body.scrollHeight}),c=7;for(var o=1;c>=o;o++)$("#click"+o+" select").append("<option value=''>--</option>").append("<option value='playpause'>Play / Pause</option>").append("<option value='next'>Next Track</option>").append("<option value='thumbup'>Thumb Up Track</option>").append("<option value='thumbdown'>Thumb Down Track</option>").append("<option value='togglefocus'>Toggle Tab</option>").append("<option value='popup'>Mini Player</option>").change(function(e){if(t.clickset){var o=$("#click"+e+" select").val();""==o?t.clickset=t.clickset.slice(0,e-1):t.clickset[e-1]=o,chrome.storage.sync.set({clickset:t.clickset})}}.bind(null,o));$("#updateplayers").on("click",function(){for(var e=[],o=0;o<i.length;o++){var n=i[o];$("#playerlist [pname="+n+"] input[type=checkbox]").prop("checked")&&(e=e.concat(s[n].origins)),s[n].all_urls&&$("#playerlist [pname="+n+"all] input[type=checkbox]").prop("checked")&&(e=e.concat(["<all_urls>"]))}chrome.permissions.request({origins:e},function(e){if($("#updateplayers").css({display:"none"}),e){for(var o=0;o<i.length;o++){var n=i[o];$("#playerlist [pname="+n+"] input[type=checkbox]").prop("checked")&&(t.active[n]=!0),s[n].all_urls&&$("#playerlist [pname="+n+"all] input[type=checkbox]").prop("checked")&&(t.active[n+"all"]=!0)}chrome.storage.sync.set({active:t.active})}resetPlayers()})}),$("#allplayers .all").on("click",function(){return e.license.match(/plus$/)?void $("#playerlist input[type=checkbox]:not(:checked)").parent().click():void a("Integrating with multiple players requires<br><span class=sctitle>SoundControl<span class=scplus> plus</span></span>")}),$("#allplayers .none").on("click",function(){$("#playerlist input[type=checkbox]:checked").parent().click()});for(var o=0;o<i.length;o++){var n=i[o],r=$("<div>").append($("<span>").attr("pname",n).append($("<input type=checkbox>").click(function(){$(this).prop("checked",!$(this).prop("checked"))})).append($("<img>").attr("src","/im/"+n+"/menulogo.png")).append(s[n].title).click(function(){if(e.license){e.license.match(/plus$/)||$("#integratewith input[type=checkbox]:checked").each(function(e,t){setPlayer($(t).parent().attr("pname"),!1)});var t=!$("input[type=checkbox]",this).prop("checked");setPlayer($(this).attr("pname"),t)}})).append(s[n].url?$("<a class=purl>").attr("href",s[n].url).click(function(e){return chrome.tabs.create({url:e}),!1}.bind(null,s[n].url)):null);s[n].all_urls&&r.append($("<span>").attr("pname",n+"all").css({visibility:t.active[n]?"visible":"hidden"}).append($("<input type=checkbox>").click(function(){$(this).prop("checked",!$(this).prop("checked"))})).append("All").click(function(){if(e.license){var t=!$("input[type=checkbox]",this).prop("checked");setPlayer($(this).attr("pname"),t)}})),$("#playerlist").append(r)}$("#playerlist *").click(function(t){e.license||(t.preventDefault(),a("Integrating with other players requires<br><span class=sctitle>SoundControl<span class=scplus> plus</span></span>"))}),window.setPlayer=function(e,o){$("#playerlist [pname="+e+"] input[type=checkbox]").prop("checked",o),s[e]&&s[e].all_urls&&$("#playerlist [pname="+e+"all]").css({visibility:o?"visible":"hidden"}),chrome.runtime.getBackgroundPage(function(n){o?chrome.permissions.contains({origins:s[e]?s[e].origins:["<all_urls>"]},function(o){o&&($("#playerlist [pname="+e+"]").addClass("active"),t.active[e]=!0,chrome.storage.sync.set({active:t.active},n.popup.updateActive)),updatePlayers()}):($("#playerlist [pname="+e+"]").removeClass("active"),t.active[e]=!1,chrome.storage.sync.set({active:t.active},n.popup.updateActive),updatePlayers())})},window.updatePlayers=function(){for(var e=[],t=0;t<i.length;t++){var o=i[t];$("#playerlist [pname="+o+"] input[type=checkbox]").prop("checked")&&(e=e.concat(s[o].origins)),s[o].all_urls&&$("#playerlist [pname="+o+"all] input[type=checkbox]").prop("checked")&&(e=e.concat(["<all_urls>"]))}chrome.permissions.contains({origins:e},function(t){console.log(e,t),$("#updateplayers").css({display:t?"none":"table"})})},window.resetPlayers=function(){$("#updateplayers").css({display:"none"});for(var o=0,n=0;n<i.length;n++){var c=i[n];o++,chrome.permissions.contains({origins:s[c].origins},function(n,i){var s=!!t.active[n]&&i&&(e.license||"pandora"==n);$("#playerlist [pname="+n+"]")[s?"addClass":"removeClass"]("active"),$("#playerlist [pname="+n+"] input[type=checkbox]").prop("checked",!!t.active[n]),0==--o&&updatePlayers()}.bind(null,c)),s[c].all_urls&&(o++,chrome.permissions.contains({origins:["<all_urls>"]},function(n,i){var s=!!t.active[n]&&i&&e.license;$("#playerlist [pname="+n+"]")[s?"addClass":"removeClass"]("active"),$("#playerlist [pname="+n+"] input[type=checkbox]").prop("checked",!!t.active[n]),0==--o&&updatePlayers()}.bind(null,c+"all")))}},$("#tabstate .control select").on("change",function(){t.hidetab="hidden"==$(this).val(),t.pintab.pandora="pinned"==$(this).val(),chrome.storage.sync.set({hidetab:t.hidetab,pintab:t.pintab})}),$("#advolume .control select").on("change",function(){t.advolume=1*$(this).val(),chrome.storage.sync.set({advolume:t.advolume})}),$("#initplaystate .control select").on("change",function(){t.initplaystate={pandora:1*$(this).val()},chrome.storage.sync.set({initplaystate:t.initplaystate})}),$("#skipvideoad .control input").on("change",function(){e.license.match(/plus$/)||($(this).prop("checked",!1),a("Skipping video ads requires <span class=sctitle>SoundControl<span class=scplus> plus</span></span>")),t.skipvideoad={pandora:$(this).prop("checked")},chrome.storage.sync.set({skipvideoad:t.skipvideoad})}),$("#listening .control input").on("change",function(){t.listening=$(this).prop("checked"),chrome.storage.sync.set({listening:t.listening})}),$("#songnotify .control select").on("change",function(){t.songnotify=1*$(this).val(),chrome.storage.sync.set({songnotify:t.songnotify}),$("#notifyprogress input").prop("disabled",t.songnotify>8)}),$("#notifyprogress .control input").on("change",function(){t.hidenotifyprogress=!$(this).prop("checked"),chrome.storage.sync.set({hidenotifyprogress:t.hidenotifyprogress})}),$("#timer_end .control select").on("change",function(){t.timer_end=$(this).val(),chrome.storage.sync.set({timer_end:t.timer_end})}),$("#timer_minutes .control select").on("change",function(){t.timer_minutes=1*$(this).val(),chrome.storage.sync.set({timer_minutes:t.timer_minutes})}),$("#artbutton .control input").on("change",function(){t.artbutton=$(this).prop("checked"),chrome.storage.sync.set({artbutton:t.artbutton})}),$("#pauselocked .control input").on("change",function(){e.license.match(/plus$/)||($(this).prop("checked",!1),a("Pause when screen off/closed requires <span class=sctitle>SoundControl<span class=scplus> plus</span></span>")),t.pauselocked=$(this).prop("checked"),chrome.storage.sync.set({pauselocked:t.pauselocked})}),$("#keyboardset a").on("click",function(){return chrome.tabs.create({url:"chrome://extensions/configureCommands"}),!1}),$("#pollcommand .control input").on("change",function(){e.pollcommandserver=$(this).val(),chrome.storage.local.set({pollcommandserver:e.pollcommandserver})}),$("#viewerrors .control input").on("click",function(){var t=e.errorlog||[];$("#errorlog").remove(),$("<div id=errorlog>").text(JSON.stringify(t)).css({"background-color":"#CCC",margin:"2em 4em",padding:"1em"}).appendTo("body"),document.body.scrollTop=document.body.scrollHeight}),u()})}}()}