if("undefined"==typeof running8tracks){var running8tracks=!0,exports={};!function(){var e={},t={},n=2;chrome.storage.local.get(null,function(t){e=t,0==--n&&b()}),chrome.storage.sync.get(null,function(e){if(t=e,!t.test)for(var o in console)console[o]=function(){};0==--n&&b()});var o=function(n,o){if("local"==o)for(var r in n)e[r]=n[r].newValue;else if("sync"==o)for(var r in n)t[r]=n[r].newValue};chrome.storage.onChanged.addListener(o);var r=function(e,t,n){if(e){t=t||0,n=n||0;var o=document.createEvent("MouseEvents");o.initMouseEvent("mousedown",!0,!0,window,1,0,0,t,n,!1,!1,!1,!1,0,null),e.dispatchEvent(o),o=document.createEvent("MouseEvents"),o.initMouseEvent("click",!0,!0,window,1,0,0,t,n,!1,!1,!1,!1,0,null),e.dispatchEvent(o),o=document.createEvent("MouseEvents"),o.initMouseEvent("mouseup",!0,!0,window,1,0,0,t,n,!1,!1,!1,!1,0,null),e.dispatchEvent(o)}};window.MutationObserver=window.MutationObserver||window.WebkitMutationObserver;var a={},s=null,i={},u={},l={},c=!1,p=function(e,t,n){return n&&t===i[e]?void 0:i[e]=t};u.isplaying=function(e){var t=document.querySelector("#player_pause_button");return p("isplaying",!(!t||"none"==t.style.display),e)},u.song=function(e){var t=document.querySelector("#now_playing .title_artist .t");return p("song",t?t.innerText.replace(/\s/g," ").trim():"",e)},u.artist=function(e){var t=document.querySelector("#now_playing .title_artist .a");return p("artist",t?t.innerText.replace(/\s/g," ").trim():"",e)},u.album=function(e){return p("album","",e)},u.albumart=function(e){var t=document.querySelector("#mix_player_details .thumb img");return p("albumart",t?t.src.replace(/w=50&h=50/,"w=500&h=500"):"",e)},u.songvote=function(e){return p("songvote",document.querySelector("#now_playing .fav.active")?1:0,e)},u.volume=function(e){var t=document.querySelector(".volume-selector");return p("volume",t?parseFloat(t.style.height)/100:1,e)},u.playlists=function(e){for(var t=document.querySelectorAll(".cover"),n=i.playlist?[i.playlist]:[],o=0;o<t.length;o++){var r=t[o].getAttribute("alt");r&&-1==n.indexOf(r)&&n.push(r)}return p("playlists",n,e)},u.playlist=function(e){var t=document.querySelector("#mix_player_details .mixname");return p("playlist",t?t.innerText:"",e)},u.elapsedratio=function(e){var t=document.querySelector("#player_progress_bar"),n=document.querySelector("#player_progress_bar_meter");return p("elapsedratio",t&&n?parseFloat(n.offsetWidth)/parseFloat(t.offsetWidth):0,e)},u.elapsedtime=function(e){return p("elapsedtime",0,e)},u.totaltime=function(e){return p("totaltime",i.durationcalc||0,e)},u.moderepeat=function(e){return p("moderepeat",!1,e)},u.modeshuffle=function(e){return p("modeshuffle",!1,e)},u.adwatch=function(e){return p("adwatch",!1,e)},l.play=function(){c=!1,r(document.querySelector("#player_play_button"))},l.pause=function(){r(document.querySelector("#player_pause_button"))},l.forcepaused=function(){c=!0,l.pause();var e=function(){c=!1,document.querySelector("#player_play_button").removeEventListener("click",e,!0),document.querySelector("#player_skip_button").removeEventListener("click",e,!0)};document.querySelector("#player_play_button").addEventListener("click",e,!0),document.querySelector("#player_skip_button").addEventListener("click",e,!0)},l.prev=function(){c=!1},l.next=function(){c=!1;var e=document.querySelector("#player_skip_button");"none"==e.style.display&&(e=document.querySelector("#next_mix_button")),r(e)},l.songvote=function(e){e!=u.songvote()&&r(document.querySelector("#now_playing .fav"))},l.volume=function(e){var t=document.querySelector("#player_volume .volume-container"),n=t.style.display;t.style.display="block";var o=document.querySelector("#player_volume .volume-range"),a=0,s=o;do a+=s.offsetTop;while(s=s.offsetParent);a+=o.offsetHeight*(1-e),r(o,0,a),t.style.display=n},l.seek=function(){},l.playlist=function(e){var t='.cover[alt="'+e.replace(/"/g,'\\"')+'"]';r(document.querySelector("a[rel=mix] "+t+", a.quick-play-story "+t)),setTimeout(function(){var t=document.querySelector("#mix_name");t&&t.innerText==e&&r(document.querySelector("#play_overlay"))},2e3)},l.moderepeat=function(){},l.modeshuffle=function(){};var d=function(){console.log("]]connect-8tracks"),s=chrome.extension.connect({name:JSON.stringify({name:"playerport",type:"8tracks",isplaying:u.isplaying(),song:u.song(),artist:u.artist(),album:u.album(),albumart:u.albumart(),songvote:u.songvote(),volume:u.volume(),playlists:u.playlists(),playlist:u.playlist()})}),s.onMessage.addListener(g),s.onDisconnect.addListener(f),s._postMessage=s.postMessage,s.postMessage=function(){try{s._postMessage.apply(s,arguments)}catch(e){f()}},window.addEventListener("pushstate",v,!0),window.addEventListener("popstate",v,!0),a={},a.playpause=new MutationObserver(function(){void 0!==u.isplaying(!0)&&(c&&i.isplaying?l.forcepaused():s.postMessage({isplaying:i.isplaying}))}),a.playpause.observe(document.querySelector("#player_play_button"),{attributes:!0,attributeFilter:["style"]}),a.songinfo=new MutationObserver(function(){var e={};e.song=u.song(!0),e.artist=u.artist(!0),e.album=u.album(!0),e.albumart=u.albumart(!0),e.playlist=u.playlist(!0),e.playlists=u.playlists(!0),e.songvote=u.songvote(!0),s.postMessage(e)}),a.songinfo.observe(document.querySelector("#now_playing"),{subtree:!0,characterData:!0,childList:!0}),a.songvote=new MutationObserver(function(){void 0!==u.songvote(!0)&&s.postMessage({songvote:i.songvote})}),a.songvote.observe(document.querySelector("#now_playing"),{subtree:!0,attributes:!0,attributeFilter:["class"]}),a.progress=new MutationObserver(function(){var e={};e.elapsedTime=u.elapsedtime(!0),e.totalTime=u.totaltime(!0),s.postMessage(e)}),a.progress.observe(document.querySelector("#player_progress_bar_meter"),{attributes:!0,attributeFilter:["style"]}),a.volume=new MutationObserver(function(){void 0!==u.volume(!0)&&s.postMessage({volume:i.volume})}),a.volume.observe(document.querySelector(".volume-selector"),{attributes:!0,attributeFilter:["style"]})},v=function(){setTimeout(function(){void 0!==u.playlists(!0)&&s.postMessage({playlists:i.playlists})},1e3)},y=function(){var e=window.history.pushState.bind(window.history);window.history.pushState=function(t,n,o){e(t,n,o);var r=document.createEvent("Event");r.initEvent("pushstate",!0,!0,window),window.dispatchEvent(r)}},m=document.createElement("script");m.id="pushstateevent",m.innerText="if(!window.pushstateeventflag)("+y.toString()+")();window.pushstateeventflag=true;document.body.removeChild(document.querySelector('#"+m.id+"'));",document.body.appendChild(m);var f=function(){if(s)try{s.disconnect()}catch(e){}s=null,running8tracks=void 0,window.removeEventListener("pushstate",v,!0),window.removeEventListener("popstate",v,!0);for(var t in a)a[t].disconnect();chrome.storage.onChanged.removeListener(o)},g=function(e){"play"==e.action&&l.play(),"pause"==e.action&&l.pause(),"forcepaused"==e.action&&l.forcepaused(),"prev"==e.action&&l.prev(),"next"==e.action&&l.next(),"thumbup"==e.action&&l.songvote(1),"thumbdown"==e.action&&l.songvote(-1),"songvote"==e.action&&l.songvote(e.songvote),"setvolume"==e.action&&l.volume(e.volume),"seek"==e.action&&l.seek(e.seek),"setplaylist"==e.action&&l.playlist(e.playlist),"togglerepeat"==e.action&&l.moderepeat(!u.moderepeat()),"toggleshuffle"==e.action&&l.modeshuffle(!u.modeshuffle())},b=function(){var e=function(){return document.querySelector("#player_box")&&"none"!=document.querySelector("#player_box").style.display?void d():setTimeout(e,500)};setTimeout(e,10)}}()}