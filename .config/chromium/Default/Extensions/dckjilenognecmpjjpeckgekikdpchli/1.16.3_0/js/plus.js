var local={},sync={};chrome.storage.onChanged.addListener(function(e,n){if("local"==n){for(var s in e)local[s]=e[s].newValue;refresh()}else if("sync"==n){for(var s in e)sync[s]=e[s].newValue;refresh()}}),chrome.storage.local.get(null,function(e){local=e,refresh()}),chrome.storage.sync.get(null,function(e){sync=e,sync.test||(console.log=console.error=function(){}),refresh()});var refresh=function(){if(sync.clickset){local.license.match(/plus$/)?($("#plusstatus .title").html("You have full <span class=scplus>plus</span> activation!"),$("#noplus").css({display:"none"})):$("#plusstatus .title").html(local.license.match(/lite$/)?"You have SoundControl <span class=sclite>lite</span>":local.license?"You have an unknown license":"You do not have <span class=scplus>plus</span>"),local.license||$("#showkey").css({display:"none"});var e=!local.license&&sync.token?sync.token:sync.brokentoken!=sync.token?sync.brokentoken:null;e?$("#showbrokentoken").text(e):$("#brokentoken").css({display:"none"}),$("#clid").text(":"+parseInt(local.id.substr(1)).toString(32)+"z"+sync.firstinstalled.toString(32)),$("body").css({visibility:"visible"})}};$(function(){$("body").css({visibility:"hidden"}),$(".upgradebutton").on("click",function(){chrome.tabs.create({url:"http://soundcontrolplus.com/id/?clid="+local.id+"&fi="+sync.firstinstalled+"&n=/pay/"})}).on("mouseenter",function(){$(".scplus",this).stop().animate({left:".4em"},100)}).on("mouseleave",function(){$(".scplus",this).stop().animate({left:"0"},200)}),$(".keybutton").on("click",function(){$(".keybutton").css({display:"none"}),$("#key").text(sync.token||"no license key").css({display:"table"})}),$("#setkey").on("click",function(){$("#setkey").after($("<input id=setkeyfield placeholder='paste license key'>")),$("#setkeyfield").after($("<div id=setkeybutton>").text("Set").click(function(){var e=$("#setkeyfield").val().toLowerCase().trim();e.length<10||(sync.token=e,chrome.storage.sync.set({token:sync.token},function(){chrome.runtime.getBackgroundPage(function(e){e.ping(),$("#setkeyfield").remove(),$("#setkeybutton").remove(),$("#setkey").css({display:""}),setTimeout(function(){location.reload()},2e3)})}))})),$("#setkey").css({display:"none"})}),refresh()});